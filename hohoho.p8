pico-8 cartridge // http://www.pico-8.com
version 38
__lua__
--hohoho
--cree par gigi, tijana et karina
--avec la legere contribution de 
--tom & chichi

function init_game()
	create_player()
	init_msg()
end

function update_game()
 if #messages==0 then
 	player_movement()
 end											
 update_camera()
 update_msg()
end

function draw_game()
	cls()
	draw_map()
	draw_player()
	draw_msg()
	draw_ui()
end
-->8
--player

function create_player()
	p={
	 shovel=0,
		candy=0,
	 gift=0,
	 key=0,
		x=4,
		y=2,
		sprite=00
	}
end

function player_movement()

 newx=p.x
 newy=p.y

	if (btnp(➡️)) newx+=1
	if (btnp(⬅️)) newx-=1
	if (btnp(⬇️)) newy+=1
	if (btnp(⬆️)) newy-=1
	
	interact(newx,newy)
	
	if not check_flag(0,newx,newy) then
		p.x=mid(0,newx,20)
		p.y=mid(0,newy,20)
	else
		sfx(0)
	end
end

function draw_player()
	spr(p.sprite,p.x*8,p.y*8)
end	


function interact(x,y)
	if check_flag(7,x,y) then
		pile_of_snow(x,y)
	elseif check_flag(2,x,y) then
		feed_the_deer(x,y)
	elseif check_flag(3,x,y) then
			pick_up_candy(x,y)
	elseif check_flag(4,x,y) then
			pick_up_key(x,y)
	elseif check_flag(6,x,y) then 
	  pick_up_shovel(x,y)
	elseif check_flag(1,x,y) then 
  pick_up_gift(x,y)
 elseif check_flag(5,x,y)
  and p.key>0 then
  open_door(x,y)
 elseif check_flag(5,x,y)
  and p.key==0 then
  create_msg("porte","oh non, c'est ferme !\n si seulement j'avais une clef...")
 --messages
 elseif x==7 and y==4 then
 	create_msg("panneau","aide tincelle a retrouver les \ncardeaux perdus par papa noel")
 elseif x==13 and y==9 then 
 create_msg("panneau","le chemin est bloque comment\nfaire pour le deblayer?")
 end
end
 
-->8
--map

function draw_map()
	map(0,0,0,0,127,63)
end

function check_flag(flag,x,y)
	local sprite=mget(x,y)
	return fget(sprite,flag)
end

function update_camera()
	local camx=mid(0,p.x-7.5,20-15)
	local camy=mid(0,p.y-7.5,20-15)
	camera(camx*8,camy*8)
end

function next_tile(x,y)
 local sprite=mget(x,y)
 mset(x,y,sprite+1)
 sfx(1)
end


  
function pick_up_gift(x,y)
 next_tile(x,y)
 p.gift+=1
end
 
function open_door(x,y)
 next_tile(x,y)
 p.key-=1
 sfx()
end

function pick_up_key(x,y)
 next_tile(x,y)
 p.key+=1
end

function pick_up_candy(x,y)
	next_tile(x,y)
	p.candy+=1
end

function feed_the_deer(x,y)
	if p.candy==0 then
 	create_msg("rodolphe","j'ai faim !\nas tu quelque chose pour moi ?")
 elseif p.candy>0 then
	 create_msg(
"rodolphe","merci ! voici une clef")
 	next_tile(x,y)
 	p.candy-=1
 end
end 

function pick_up_shovel(x,y)
 next_tile(x,y)
 p.shovel+=1
end

function pile_of_snow(x,y)
	if p.shovel>0 then
		newx=p.x
		newy=p.y
		next_tile(x,y)
	end
end
-->8
--sign

function init_msg()
 messages={}
end

function update_msg()
 if btnp(❎) then	
	 deli(messages,1)
 end
end

function draw_msg()
	if messages[1] then
	 local y=100
	 rectfill(7,y,11+#msg_title*4,y+7,2)
	 print(msg_title,10,y+2,9) 
	
	 rectfill(3,y+8,124,y+24,4)
	 rect(3,y+8,124,y+24,4)
  print(messages[1],6,y+11,15)
	end
end
 
--messages

function create_msg(name,...)
 msg_title=name
 messages={...}
end

-->8
--main page

function _init()
init_menu()
end

function _update()
end

function _draw()
end


-----------menu -------------------
 
 function init_menu()
  _update = update_menu
  _draw = draw_menu
 end
 
 function update_menu()
 if btnp(❎) then 
  _init = init_game()
  _update = update_game
  _draw = draw_game
 end
end

function draw_menu()
cls()
map(113.5,0,0,0)
print ("press ❎ to start",30,60,8)
end 



 
-->8
--ui
function draw_ui()
 camera(0,0)
	spr(43,2,2)
	print_outline(p.gift.."/3",13,4)
end

function print_outline(text,x,y)
 print(text,x-1,y,0)
 print(text,x+1,y,0)
 print(text,x,y-1,0)
 print(text,x,y+1,0)
 print(text,x,y,7)
end
__gfx__
00838383666666666444444466673766666666666666666666666666444445554444444455555444555555556466646666666666666666666666666600000000
033333386666666667707076667b33766666666666cc6cc666666666444555554444444455544444555555556644466666666666666666669999999900000000
0f5f5f03666666666777977666b3333666766666666ccc666666666644444555444444445555544455555555684466666a666666666666664444444400000000
0fffff006666666666777766667b3376666666666888c888666666664445555545454545555444444545454566646664a0aaaa66666666664242242400000000
3333333f666666666683838667b33337666666666888c8886666666644444555454545455555544445454545666494466a666a66666666664444444400000000
f445440466666666677778766b333333666666666ccccccc66666666444555555555555555544444444444446664444666666666666666666626626600000000
08888844667666666777737666664566666666666888c88866666666444445555555555555555444444444446664664666666666666666666646646600000000
05000544666666666877778666664566666666666888c88866666666444555555555555555544444444444446669669666666666666666666646646600000000
000000006666666666b6b6666666666666666666188888811880000144444444664566666666666666666666666d666666666666666666666666666666666666
0000000066444666666b66666678766666666666880505088850000044444444664566666666666666666666665dd666666666666666566666cc6cc666666666
0000000064444466669996666686866666666666980505089552000065566556664566666666666666666666655ddd666666666666657566666ccc6666666666
000000004444044666aa96666666766666666666988888889582000065566556664555566666666666666666655ddd6666666666665777566888c88866666666
00000000444444466699966666668666666666668888885888820000666666666644444666666666666666666554dd6666666666657777756888c88866766666
000000005404446666aa9666666676666666666698888868988200006666666666444446666666666666666665646d6666666666577777776ccccccc66666666
00000000654445666699966666668666666666669828288898200000666666666656665666666666666666666664666666666666777777776888c88866666666
00000000665556666669666666666666666666664228282882000000666666666666666666666666666666666664666666666666555555556888c88866666666
666666678888886666666665555555556666666666666666000000005555555555555555666666666666666666cc6cc600000000000000000000000000000000
6666668882288886666666577777777756666666666666660000000055555555555555556666666666666666666ccc6600000000000000000000000000000000
66666788688888886666665755555557566666666666666600000000555555555555555566666666666666666888c88800000000000000000000000000000000
66666777622222226666666558888857555666666555556600000000555545455454555566666666666666666888c88800000000000000000000000000000000
66667666677777776666666658888857777566666577775600000000555445455454455566666666666666666ccccccc00000000000000000000000000000000
66666666674040476666666658888885557756665775575600000000555554444445555566666666666666666888c88800000000000000000000000000000000
6666666667e444e76666666658888888885755665758556600000000555444444444455566666666666666666888c88800000000000000000000000000000000
66666666677444776666666658888878885775555758566600000000555554444445555566666666666666666666666600000000000000000000000000000000
66666666667777766666666658888787888577777758566600000000555554444445555566666666666666660000000000000000000000000000000000000000
66666666666777666666666665888878888855555588566600000000555444444444455566666666666666660000000000000000000000000000000000000000
66666666668878866666666665888888888888888882566600000000555554444445555566666666666666660000000000000000000000000000000000000000
66666666688888886666666666522222222222222225665600000000555445455454455566666666666666660000000000000000000000000000000000000000
666666666800a0086666666666655555555555555556666500000000555545455454555566666666666666660000000000000000000000000000000000000000
66666666647777746666666666666566666566666566666500000000555555555555555566666666666666660000000000000000000000000000000000000000
66666666666868666666666666666566666566666566665600000000555555555555555566666666666666660000000000000000000000000000000000000000
66666666664464466666665555555555555555555555556600000000555555555555555566666666666666660000000000000000000000000000000000000000
66666666666666666666666666666676000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66677666667766666666667777766666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66678666667866666666778888877666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66678666667866666667886666688766000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66678667667866666678666666666876000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66678666667866666786666666666687000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66678666667866666866666666666668000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66678666667866666866666666666668000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66678777777866666866666666666668000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66678888887866666866676666666668000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66678666667866666866666666666668000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66678666667866766876666666666678000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66678666667866666687666666666786000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66678666667866666668776666677866000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
76678666667866666666887777788666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666668888866666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000010100030001010101051100010000000108002100010100004000810300010101000000000101000000000000000001050404000001010000000000000000040004040000000000000000000000000404040400000000000000000000000004040404000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0101010101010101010101010101010101010101011010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000301010101010101010101030303030303030303030303030303
0101010104030303030301010101010101010101011010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000301010101010101010101030404040404040404040404040403
0101030104030301040401040404040101010101011010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000301010101010101010101030440414243404142434041424303
0103030301010101010201010404040101010101011010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000301010101010101010101030450515253505152535051525303
010303010104010e040404010404040101010101011010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101030404040404040404040404040403
0101010104040101040101010301010101010101011010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101030404040404040404040404040403
010402042104021b010105010301010101010101011010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101030404040404040404040404040403
0104040431040101010101010101010101010101011010101010101010101c1c101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101030404040411040404040404040403
0101010101010101010101010101011d0101010101101010101010101c1c1c1c101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101030404010101010101010101010103
010101040101010101040101010e01010101010101101010101010101c1c1c10101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101030404010101010101010101010103
010101040404040404040101010101010401010101101010101010101c1c1010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101030101010105010101010101010103
01010104270a150a0a280101010101010101010101101010101010101c10101022101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010101010101010103012021222324250b0b0b0b010103
010101040906060606070101010101010101010101101010101010101c10102222101010000010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010101010101010103010131323334350b0b0b0b010103
010101010906060606070101010101010101010101101010101010101c101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101030101010101010101010101010103
0101010109180605060701010101010101010101011010101010101010102222101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101030101010101010101010101010103
0101010109181717060701010101010101130101011010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101030303030303030303030303030303
0101010137080808083801010101010101010101011010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010101010101010101010101010101
0101010101010101010101010104010101010101011010100010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101011010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010101010101010101010101010103
010101010101010b010101010101010101010101011010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010101010101010101010101010103
0101010101010101010101010101010101010101011010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010101010101010101010101010103
__sfx__
680e00000d2500c2500b2500a25000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000001c35020350223502535029350000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
011300001c350000001c350000001c35000000000001c350000001c350000001c35000000000001c3500000000000183500f3501c350000000000000000000000000000000000000000000000000000000000000
011800001c5551c5551c555000001c5551c5551c555000001c5551f555185551a5551c55500000000001c5551d5551d5551d5551d5551c5551c5551c5551c5551a5551a5551c5551a555000001f5550000000000
011800000e5150c5150e5150c5150e5150c5150e5150c5150e5150c5150e5150c5150e5150c5150e5150c5150e5150c5150e5150c5150e5150c5150e5150c5150e5150c5150e5150c5150e5150c5150e5150c515
79180000000001c5251c5251c525000001c5251c5251c525000001c5251f525185251a5251c52500000000001c5251d5251d5251d5251d5251c5251c5251c5251c5251a5251a5251c5251a525000001f52500000
011800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__music__
00 04030544

